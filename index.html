<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Michael的小屋">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Michael的小屋">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Michael的小屋">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> Michael的小屋 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Michael的小屋</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/17/Home_Page/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Michael的小屋">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael的小屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/17/Home_Page/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-17T13:54:51+08:00">
                2017-03-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/07/Block循环引用的三种解决方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Michael的小屋">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael的小屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/07/Block循环引用的三种解决方式/" itemprop="url">
                  Block循环引用的三种解决方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-07T14:27:12+08:00">
                2017-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天 抽空看了下 <em>Objective-C高级编程iOS与OSX多线程和内存管理</em>，发现自己之前所理解的<code>为什么block会发生循环引用？</code>有些理解是错误的，还好看了这个书，最后弄清楚了，希望写出来，既能算是一种总结，又能让其他小伙伴避免再遇到这个坑！下面 让我们一起来看几个场景！</p>
<p>项目简单的类结构<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">import &quot;ViewController.h&quot;</div><div class="line">#import &quot;DetailViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123;</div><div class="line"></div><div class="line">DetailViewController *detailVC = [DetailViewController new];</div><div class="line">detailVC.testMemoryLeaksBLock = ^(DetailViewController *d) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;d: %@--&quot;, d);</div><div class="line">&#125;;</div><div class="line">[self presentViewController:d animated:YES completion:nil];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//---------------------DetailViewController-----------------------------</div><div class="line">@interface DetailViewController : UIViewController</div><div class="line"></div><div class="line">@property (nonatomic, copy) void(^testMemoryLeaksBLock)(DetailViewController *detailVC);</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation DetailViewController</div><div class="line"></div><div class="line">-(void)dealloc &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;dealloc&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)viewDidDisappear:(BOOL)animated &#123;</div><div class="line"></div><div class="line">[super viewDidDisappear:animated];</div><div class="line">!_testMemoryLeaksBLock ?: _testMemoryLeaksBLock(self);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123;</div><div class="line">[self dismissViewControllerAnimated:YES completion:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="场景一"><a href="#场景一" class="headerlink" title="场景一"></a>场景一</h3><p>正如项目结构那样，当detailVC disappear时候，回调block是否会有内存泄漏呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">detailVC.testMemoryLeaksBLock = ^(DetailViewController *d) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;d: %@--&quot;, d);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2546918-99b5400dff7efc76.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="局部变量不会造成，执行完自动释放，不会造成内存泄漏 - 1"><br>正如上面分析图，一般情况下，是有内存泄漏的，但就是由于<code>detailVC.testMemoryLeaksBLock</code>所持有的<code>d</code>指针是一个局部变量，当block执行完之后，这个局部变量引用计数就为0，就被释放了，因此<code>d</code>  就不再持有<code>detailVC</code>，<code>detailVC.testMemoryLeaksBLock</code>对<code>detailVC</code>就不再持有, 循环引用被打破，还是会走 <code>-[DetailViewController dealloc]</code> 的.</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2546918-cb2f6d53f8269691.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="局部变量不会造成，执行完自动释放，不会造成内存泄漏 - 2"></p>
<h3 id="场景二"><a href="#场景二" class="headerlink" title="场景二"></a>场景二</h3><p>block代码改成下面这样，当detailVC disappear时候，回调block是否又会有内存泄漏呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">DetailViewController *detailVC = [DetailViewController new]; </div><div class="line">id  tmp = detailVC;</div><div class="line">detailVC.testMemoryLeaksBLock = ^(DetailViewController *d) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;d: %@--\nd: %@&quot;,  d,  tmp); </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>答案：的确有内存泄漏 ，因为循环引用的问题，具体看下图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2546918-fe43da2b0ccbe275.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="循环引用造成内存泄漏 "></p>
<p>上面情况如果懂的话，下面这种写法是一样的，经典的循环引用<br><code>detailVC</code>持有<code>testMemoryLeaksBLock</code>，<code>testMemoryLeaksBLock</code> 持有 <code>detailVC</code>,导致两个引用计数都无法减一，最后谁也释放不了谁！！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">DetailViewController * detailVC = [DetailViewController new]; </div><div class="line">detailVC.testMemoryLeaksBLock = ^(DetailViewController *d) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;detailVC: %@&quot;,  detailVC); </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>##如何解决内存泄漏<br>原因我们了解了，现在是该如何解决了，下面根据之前场景逐一给出不同的思路，注意思路很重要，因为有很多种解决思路，都要搞清楚，举一反三，因为场景一没有内存泄漏，因此主要针对场景二</p>
<p>###针对场景二的解决方案1：<br>有问题的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">DetailViewController *detailVC = [DetailViewController new]; </div><div class="line">id  tmp = detailVC;</div><div class="line">detailVC.testMemoryLeaksBLock = ^(DetailViewController *d) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;tmp: %@&quot;,  tmp); </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>方案一的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">DetailViewController * detailVC = [DetailViewController new];</div><div class="line">__block id tmp = detailVC;</div><div class="line">detailVC.testMemoryLeaksBLock = ^(DetailViewController *d) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;tmp: %@&quot;,  tmp); </div><div class="line">tmp = nil;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>虽然解决了内存泄漏，但是细心的看客姥爷肯定发现了这样写的一个弊端，没错，那就是 如果 <code>detailVC.testMemoryLeaksBLock ()</code>没有调用的话，还是会造成内存泄漏的，因为<code>testMemoryLeaksBLock</code>还是间接地强引用了<code>detailVC</code>, 算是一个思路吧，毕竟思路要广才能 想的更多，学的更多，不是吗！</p>
<p>###针对场景二的解决方案2：<br>有问题的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">DetailViewController *detailVC = [DetailViewController new]; </div><div class="line">id  tmp = detailVC;</div><div class="line">detailVC.testMemoryLeaksBLock = ^(DetailViewController *d) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;tmp: %@&quot;,  tmp); </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>方案二的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">DetailViewController * detailVC = [DetailViewController new];</div><div class="line">__weak id weakTmp = detailVC;</div><div class="line">detailVC.testMemoryLeaksBLock = ^(DetailViewController *d) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;weakTmp: %@&quot;,  weakTmp); </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>这也是平常开发中用得最多的一种解决循环引用的方法。来给小总结吧：方案一和方案二都是断掉<code>testMemoryLeaksBLock</code>对<code>detailVC</code>的强引用，自然可以；其实开发中还有一种方案也是可以的，那就是 断掉<code>detailVC</code>对 <code>testMemoryLeaksBLock</code> 的强引用。</p>
<p>###针对场景二的解决方案3：<br>有问题的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">DetailViewController *detailVC = [DetailViewController new]; </div><div class="line">id  tmp = detailVC;</div><div class="line">detailVC.testMemoryLeaksBLock = ^(DetailViewController *d) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;tmp: %@&quot;,  tmp); </div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>方案三的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@implementation DetailViewController</div><div class="line"></div><div class="line">-(void)dealloc &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;dealloc&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)viewDidDisappear:(BOOL)animated &#123;</div><div class="line"></div><div class="line">[super viewDidDisappear:animated];</div><div class="line">!_ testMemoryLeaksBLock ?: _testMemoryLeaksBLock(self);</div><div class="line">//就加了下面一行代码也是可以的，因为一旦手动把 _testMemoryLeaksBLock置为空,  那么这个block就没有任何对象持有它，</div><div class="line">//换一句话说就是没有对象强引用这个block, 那么如果这个block之前在堆里，它就会被废弃掉，</div><div class="line">_testMemoryLeaksBLock= nil;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure></p>
<p>每一次执行完block之后都手动置nil，断掉<code>detailVC</code>对 <code>testMemoryLeaksBLock</code> 的强引用也不失为一种方法。</p>
<p>####总结：这也是平常开发中三种解决循环引用的方法。希望大家周末都玩得开心，么么哒，下周准备写 GCD，有好多 线程同步的 知识，望 共同努力，共勉，手动！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/07/iOS8 自定义UITabBar （使用popToViewController导致的UITabBarButton重叠的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Michael的小屋">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael的小屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/07/iOS8 自定义UITabBar （使用popToViewController导致的UITabBarButton重叠的问题/" itemprop="url">
                  iOS8 自定义UITabBar （使用popToViewController导致的UITabBarButton重叠的问题）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-07T14:27:12+08:00">
                2017-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>想看详细的，可以看这篇<a href="http://transcoder.baidu.com/from=1099b/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%401320_2001%2Cta%40iphone_1_10.0_3_602/baiduid=EC8C128BEBFC5A61693EBE2EC90B1614/w=0_10_/t=iphone/l=3/tc?ref=www_iphone&amp;lid=16210680801311434981&amp;order=5&amp;fm=alop&amp;tj=www_normal_5_0_10_title&amp;vit=osres&amp;m=8&amp;srd=1&amp;cltj=cloud_title&amp;asres=1&amp;title=...%28使用popToViewController导致的UITabBarButton...&amp;dict=30&amp;w_qd=IlPT2AEptyoA_yikJVOgGS1trQTCRbWhG_&amp;sec=15971&amp;di=43f7179851d00068&amp;bdenc=1&amp;tch=124.517.353.912.1.334&amp;nsrc=IlPT2AEptyoA_yixCFOxXnANedT62v3IEQGG_yFZ0z3xokmyxP4kHREsRDb6NnTLJ5DhxWeCvBYIwHWa_nhunM5X&amp;eqid=e0f7e84d0969a8001000000258036a3a&amp;wd=&amp;clk_info=%7B%22srcid%22%3A%221599%22%2C%22tplname%22%3A%22www_normal%22%2C%22t%22%3A1476620498282%2C%22xpath%22%3A%22div-div-div-a-p%22%7D" target="_blank" rel="external">文章</a>，有时候 在popToViewController 的时候 ，原本一开始被我们移除的UITabbarButton会莫名其妙的再次加载到UITabBar上了，考虑到我们一开始就在UITabBarController的- ViewDidLoad 方法里面移除了，如下面这样：</p>
<p>//@interface MainTabBarController : UITabBarController</p>
<ul>
<li>(void)viewDidLoad {</li>
</ul>
<p>for (UIView *subView in self.tabBar.subviews) {</p>
<p>[subView removeFromSuperview];<br>}<br>//自定义一些控件子视图<br>}<br>而且 -ViewDidLoad 此方法在生命周期里面只会走一次，所以我们断定一定是在Apple 在  <code>[super viewWillLayoutSubviews]</code> 做了一些判断，所以我们必须要在  <code>[super viewWillLayoutSubviews]</code> 之后再移除掉就行了</p>
<p>//@interface MainTabBarController : UITabBarController</p>
<ul>
<li>(void)viewWillLayoutSubviews {</li>
</ul>
<p>[super viewWillLayoutSubviews];</p>
<p>for (UIView *subView in self.tabBar.subviews) {</p>
<p>![subView isKindOfClass:NSClassFromString(@”UITabBarButton”)] ?: [subView removeFromSuperview];<br>}<br>}</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/07/iOS头文件中如何在宏里引用已有的宏/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Michael的小屋">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael的小屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/07/iOS头文件中如何在宏里引用已有的宏/" itemprop="url">
                  iOS头文件中如何在宏里引用已有的宏
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-07T14:27:12+08:00">
                2017-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一般我们在开发环境中经常会有这样的需求，如果有不是很多的接口的话，一般会这样写</p>
<p>#define kLoginURLStr                @”<a href="http://test.yunlu6.com/api/v1/login" target="_blank" rel="external">http://test.yunlu6.com/api/v1/login</a>“</p>
<p>#define kLogoutURLStr               @”<a href="http://test.yunlu6.com/api/v1/logout" target="_blank" rel="external">http://test.yunlu6.com/api/v1/logout</a>“<br>但是 一般 公司 接口少则几十个，多则上百个，要是将来改的话，会稍显麻烦，且容易出错，于是会有下面优化的写法：</p>
<p>#define kTestHostName                @”<a href="http://test.yunlu6.com" target="_blank" rel="external">http://test.yunlu6.com</a>“</p>
<p>#define kLoginURL                    @”” kTestHostName@”/api/v1/login”</p>
<p>#define kLogoutURLStr                @”” kTestHostName@”/api/v1/logout”<br>但是很多公司的服务器环境经常会变动，因此，我们还需要考虑到切换域名的情况，于是下面就会写出最终的写法</p>
<p>#define kTestHostName                @”<a href="http://test.yunlu6.com" target="_blank" rel="external">http://test.yunlu6.com</a>“</p>
<p>#define kDevelopHostName             @”<a href="http://develop.yunlu6.com" target="_blank" rel="external">http://develop.yunlu6.com</a>“</p>
<p>#define kHostName                    kDevelopHostName</p>
<p>#define kLoginURL                    @”” kHostName@”/api/v1/login”</p>
<p>#define kLogoutURLStr                @”” kHostName@”/api/v1/logout”</p>
<p>以后就只需要更改这一行宏就可以了</p>
<p>#define kHostName                    kDevelopHostName/kTestHostName/kOtherHostName</p>
<p>注：@”” kTestHostName@”/api/v1/login”中 kTestHostName前面必须要有空格用来区分字面量引号”和标志符kTestHostName,否则在编译时候会报错， Invalid suffix on literal; C++11 requires a space between literal and identifier，好的，一切编译正常！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/07/一行代码解决UITableView键盘收起/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Michael的小屋">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael的小屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/07/一行代码解决UITableView键盘收起/" itemprop="url">
                  一行代码解决UITableView键盘收起
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-07T14:27:12+08:00">
                2017-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##iOS中常用地收起键盘的几种方式</p>
<ul>
<li>#####添加singleTap单击手势</li>
<li>#####调用API方法</li>
</ul>
<p>####1.添加singleTap单击手势</p>
<p>UITapGestureRecognizer *singleTapGesture = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(closeKeyboard:)];<br>singleTapGesture.numberOfTapsRequired = 1;<br>singleTapGesture.cancelsTouchesInView = NO;<br>[tableView addGestureRecognizer:singleTapGesture];</p>
<p>#pragma mark - gesture actions</p>
<ul>
<li>(void)closeKeyboard:(UITapGestureRecognizer <em>)recognizer {<br>//在对应的手势触发方法里面让键盘失去焦点<br>[_textField resignFirstResponder];<br>//或者使用第二种方法,该方法会一直找到textField或者内嵌的texfield，让它取消第一响应者<br>//[self.view endEditing:YES];<br>}<br>大家可能会对cancelsTouchesInView这个属性有所好奇，为什么要设置成NO，我们通过看其官方API<br>A Boolean value affecting whether touches are delivered to a view when a gesture is recognized.<br>default is YES. causes touchesCancelled:withEvent: or pressesCancelled:withEvent:<br>to be sent to the view for all touches or presses recognized as part of this gesture immediately before the action method is called.<br>这句话的意思就是说设置这个值将会影响到手指的触摸事件是否会传送到添加该手势的View上在本文中即recongizer.view(tableView)<br>这样可能还是不够清晰，再说清楚一些就是当我们添加一个reconnizer手势给一个视图的时候，当前window分发触摸事件的时候，<br>会先问该手势有没有被识别(可以理解为于手势绑定的action方法有没有被触发)，当手势识别成功，就会问cancelsTouchesInView是否为YES，如果设置为YES，<br>触摸事件就不会继续分发，那么tableview的 tableView:(UITableView </em>)tableView didSelectRowAtIndexPath:(NSIndexPath <em>)indexPath方法不会触发，<br>因为触摸事件被提前结束了！当手势识别失败的时候(即没有被调用的时候), window就会继续把事件传递下去给该tableView,因为View也是继承自UIResponder的,<br>会立即执行 touchesCancelled:withEvent: or pressesCancelled:withEvent: 到此一个触摸事件循环结束！那么当cancelsTouchesInView设置为NO会发生什么样的变化呢？<br>前面还是不变，当手势识别成功，就会问cancelsTouchesInView是否为YES，如果设置为NO，触摸事件会继续传递给响应链，就不会立即返回，因此还是会调用tableView的<br>tableView:(UITableView </em>)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath 还有cell 的按钮触发方法，都是不会受到影响的！</li>
</ul>
<p>换句话说就是cancelsTouchesInView ：如果Recognizer分析成功,就会解除View上的绑定的剩余手势事件，那么windows也不会给发送这写手势事件。<br>windows通过给view发送touchesCancelled:withEvent:消息来退出旧事件处理。</p>
<p>####2.调用API方法<br>tableView.keyboardDismissMode = UIScrollViewKeyboardDismissModeOnDrag;<br>UIScrollViewKeyboardDismissModeNone,//默认第一种，为none<br>UIScrollViewKeyboardDismissModeOnDrag,//键盘会当tableView上下滚动的时候自动收起<br>UIScrollViewKeyboardDismissModeInteractive, // 设置键盘的消失方式为拖拉并点击页面，iOS7新增特性</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/07/一行核心代码做出类似tableViewHeaderView和AppStore里的ScrollView悬浮条效果/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Michael的小屋">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael的小屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/07/一行核心代码做出类似tableViewHeaderView和AppStore里的ScrollView悬浮条效果/" itemprop="url">
                  一行核心代码做出类似tableViewHeaderView和AppStore里的ScrollView悬浮条效果
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-07T14:27:12+08:00">
                2017-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>现在主流app里面经常需要有tableView上滑出现悬浮条样式的设计，宝宝看了下appleStore里面专题推荐用的scrollView 也有类似的悬浮效果，只不过它是下拉悬浮，而主流的是上滑悬浮！最终实现效果如以下gif图。<br><img src="http://upload-images.jianshu.io/upload_images/2546918-daecab37aeea565e.gif?imageMogr2/auto-orient/strip" alt="上滑悬停条样式"><br><img src="http://upload-images.jianshu.io/upload_images/2546918-7e1e67715b9f7e73.gif?imageMogr2/auto-orient/strip" alt="appStore下拉悬浮条效果"><br><img src="http://upload-images.jianshu.io/upload_images/2546918-34237448f69a56bb.gif?imageMogr2/auto-orient/strip" alt="仿appStore效果"><br><em>其实一看上去 表以为是两种不同的方案，其实两种思路方式完全一致，本来核心代码就一行，那么要修改的代码岂不是半行，确实如此哦，宝宝已笑疯😂😂😂，好了啦，开个玩笑，进入正题！</em></p>
<p>##先别敲代码，想想悬浮条实现思路</p>
<ul>
<li>###上滑悬浮条样式的思路<br>当你看到本文第一张的动图的时候你想到了什么，对，没错，上滑的时候高度在减小最后会减小到一个固定值，下滑的时候高度在增加最后也会增加到一个固定值，那么简单点描述就是悬浮条原点不变，让其高度减小，在下面代码里第二种实现方式就是这样；其实我实现的是让悬浮条的原点变化，高度不变，也是一样的效果。</li>
<li>###appStore下拉悬浮条样式的思路<br>有了第一种思路，会发现下拉悬浮条的过程与上面惊人的相似，上滑的时候高度在减小，只不过最后会减为0，下滑的时候高度在增加最后也会增加到一个固定值。</li>
<li>###技术实现<br>通过KVO监听tableView的contentOffset属性值或者在scrollView的代理方法中监听contentOffset的值来让悬浮条的原点变化，高度不变，或者原点不变，高度变化！<br>将自定义的headerView放在tabView 的上面，即headerView和tableView为平级关系，都添加到viewController的view上，然后设置tableView的contentInset为headerView的值，在tableView滑动的时候，动态改变view的位置或者大小，使这个headerView看起来就像是有了悬浮功能的tableView.tableHeaderView。</li>
<li>###核心代码<br>宝宝真的没有骗你们，真的只要一行，只要你看得懂就行😂😂😂，因为我把五行if语句和成一行了，表问我为什么！<br>_yellowView.frame = offset.y &lt; -64 ? (offset.y &lt;= -200 ?  CGRectMake(0, 0, 375, 200) : CGRectMake(0, -offset.y - 200, 375, 200)) : CGRectMake(0, 64 - 200, 375, 200);</li>
</ul>
<p>##代码实现</p>
<ul>
<li>(void)viewDidLoad {</li>
</ul>
<p>[super viewDidLoad];<br>//加载tableView到self.view上<br>UITableView *tableView = [[UITableView alloc]  initWithFrame:CGRectMake(0, 0, 375, 667) style:UITableViewStylePlain];<br>[tableView registerClass:[UITableViewCell class] forCellReuseIdentifier:@”Cell”];<br>tableView.dataSource = self;<br>tableView.contentInset = UIEdgeInsetsMake(200, 0, 0, 0);<br>[self.view addSubview:tableView];<br>//利用KVO监听tableView的contentOffset的属性值，从而动态改变悬浮条yellowView的frame值<br>[tableView addObserver:self forKeyPath:@”contentOffset” options:NSKeyValueObservingOptionNew context:nil];</p>
<p>//加载yellowView作为悬浮条视图到self.view上，因此tableView和yellowView是同一级关系，黄色视图在tableView的上面<br>TouchView *yellowView = [[TouchView alloc] initWithFrame:CGRectMake(0, 0, 375, 200)];<br>yellowView.backgroundColor = [UIColor yellowColor];<br>//将alpha设置成为0.7的透明度是为了看得更清楚底下的tableView随时滚动的位置<br>yellowView.alpha = 0.7;<br>[self.view addSubview:yellowView];<br>//设置成全局的实例变量是为了在监听方法中可以改变悬浮条yellowView的frame值<br>_yellowView = yellowView;<br>}</p>
<p>#pragma mark - KVO监听tableView的contentOffset的属性值变化<br>-(void)observeValueForKeyPath:(NSString <em>)keyPath ofObject:(id)object change:(NSDictionary<nskeyvaluechangekey,id> </nskeyvaluechangekey,id></em>)change context:(void *)context {</p>
<p>CGPoint offset = [change[NSKeyValueChangeNewKey] CGPointValue];</p>
<p>//64为悬浮条最终停留的高度<br>if (offset.y &lt; -64) {</p>
<p>//小于-64则有两种情况，第一种小于-64是当悬浮条一进来时候，由于contentInset.top被我们调成了悬浮条的高度200，<br>因此offset.y初始值是-200，当用户上滑悬浮条的时候，会在 -200 &lt;= offset.y &lt;= -64 范围内波动，我们需要<br>调整悬浮条的Y坐标为-offset.y - 200，如- (-180) - 200 = -20 ,代表tableView向上偏移了20各点，我们改变其原点，<br>造成悬浮条悬停的假象;第二种小于-64是当悬浮条一进来时候，offset.y初始值是-200,当用户下滑悬浮条的时候，offset.y会负的越多，<br>在 offset.y &lt; -200 范围内波动，我们需要调整悬浮条的Y坐标为固定值200，不让其变大变小即可！！搞定</p>
<p>//第一种方案，改变悬浮条的Y坐标，而不改变其高度，这也是本文核心代码！！！！<br>_yellowView.frame = offset.y &lt;= -200 ?  CGRectMake(0, 0, 375, 200) : CGRectMake(0, -offset.y - 200, 375, 200);</p>
<p>//第二种方案，改变悬浮条的高度，而不改变其原点<br>//_yellowView.frame = offset.y &lt; -200 ?  CGRectMake(0, 0, 375, 200) : CGRectMake(0, 0, 375, -offset.y);</p>
<p>//下面这行代码没必要添加，我看到网上很多人加了这句，实属没必要，tableView滚动本来就靠contentOffset，contentInset只是添加额外的滚动区域的<br>//_tableView.contentInset = offset.y &gt; -200 ? UIEdgeInsetsMake(-offset.y, 0, 0, 0) :UIEdgeInsetsMake(200, 0, 0, 0);<br>}else {</p>
<p>//大于等于-64就只有一种情况了，当到达临界值的时候就会 悬停64的最小高度，该高度自己随便写啦，然后appStore那个效果是上滑到临界值后，高度依然减小，<br>那么需要调整悬浮条的Y坐标为-offset.y - 200，offset.y会越来越 大于-64，导致_yellowView.frame.origin.y负的越多，越来偏离屏幕原点，<br>正好满足需求看不见悬浮条啦！</p>
<p>//appStore下拉悬浮条效果只需要改这行代码让上滑的时候原点超过其高度200，这样就看不到悬浮条了<br>//_yellowView.frame = CGRectMake(0, -offset.y - 200, 375, 200);;</p>
<p>//第一种方案，改变悬浮条的Y坐标为悬停最小值64 - 200，这样在用户界面上就只显示64的高度，而不改变其高度<br>_yellowView.frame = CGRectMake(0, 64 - 200, 375, 200);</p>
<p>//第二种方案，改变悬浮条的高度为最小值64，而不改变其原点<br>//_yellowView.frame = CGRectMake(0, 0, 375, 64);</p>
<p>//下面这行代码没必要添加，我看到网上很多人加了这句，实属没必要，tableView滚动本来就靠contentOffset，contentInset只是添加额外的滚动区域的<br>//_tableView.contentInset = UIEdgeInsetsMake(64, 0, 0, 0);<br>}<br>}</p>
<p>###自定义TouchView<br>如果有另外需求比如要是拖动黄色视图，tableView要是也能滚动的话，那么就需要自己拦截点击事件！！</p>
<p>@implementation TouchView</p>
<p>//这两个方法随便写一个即可，为的是拦截响应链，不让其捕获到触摸事件，这样用户手指点击上面的黄色视图，window分发触摸事件的时候，会认为用户点击的那个点最远的响应视图是 tableView，因为tableView在黄色视图的下方，这样，当滑动黄色视图的时候，tableView也跟着一起滚动了啦！！！</p>
<ul>
<li>(BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {<br>return NO;<br>}</li>
</ul>
<p>//先调用hitTest:withEvent:此方法，再调用pointInside:withEvent:<br>-(UIView <em>)hitTest:(CGPoint)point withEvent:(UIEvent </em>)event {</p>
<p>UIView *view = [super hitTest:point withEvent:event];<br>if ([view isKindOfClass:[self class]]) {</p>
<p>return nil;<br>}<br>return nil;<br>}</p>
<p>@end</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/07/Fixed "There was a problem with the editor 'vi'" /">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Michael的小屋">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael的小屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/07/Fixed "There was a problem with the editor 'vi'" /" itemprop="url">
                  Fixed "There was a problem with the editor 'vi'"
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-07T14:27:12+08:00">
                2017-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在用git提交的时候 如果不小心打错了commit -m ‘xxx’ xxx里面的内容的话，可以修改，命令是<code>git commit --amend</code></p>
<p>apple:yunlu_meeting apple$ git commit -m ‘delete redu’<br>//这时候发现打字还没打完 电脑卡了手贱 多按了回车，郁闷，于是再一次修改提交信息<br>apple:yunlu_meeting apple$ git commit –amend<br>//WTF，<code>Vi</code>编辑器遇到问题,<br>error: There was a problem with the editor ‘vi’.<br>Please supply the message using either -m or -F option.<br>解决方法是</p>
<p>$ git config –global core.editor /usr/bin/vim -f</p>
<p>完整的终端打印如下：</p>
<p>apple:yunlu_meeting apple$ git commit –amend<br>error: There was a problem with the editor ‘vi’.<br>Please supply the message using either -m or -F option.<br>apple:yunlu_meeting apple$ git config –global core.editor  /usr/bin/vim -f<br>apple:yunlu_meeting apple$ git commit –amend<br>[addChat e38cfe4] delete redundant key-values in HBuilder-Hello-Info.plist<br>Date: Sat Oct 8 17:48:46 2016 +0800<br>apple:yunlu_meeting apple$ git push origin addChat:addChat<br>Counting objects: 198, done.<br>Delta compression using up to 2 threads.<br>Compressing objects: 100% (114/114), done.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/07/Git 最著名报错终极解决方案/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Michael的小屋">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Michael的小屋">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/07/Git 最著名报错终极解决方案/" itemprop="url">
                  Git 最著名报错终极解决方案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-07T14:27:12+08:00">
                2017-03-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天和同事在弄github的时候，遇到了点小麻烦，在全球最大的中文网上一搜，果然不出所料，找不到写解决方案，于是自己在stackOverFlower上看了好几篇，总结了一下，终于找到解决方案！报错如下：<br><em><code>ERROR: Permission to hbxn740150254/BestoneGitHub.git denied to Chenzuohehe.
fatal: Could not read from remote repository.Please make sure you have the correct access rights
and the repository exists.</code></em><br>初看知道大概是没有权限，导致不能从远程仓库读取，后来询问才知道我同事的电脑的SSH公钥已经绑定了他自己的GitHub 账号，我就不能再用他的公钥了，具体的请看stackoverflow网友所说的：<br><em><code>GitHub will use the key as means to identify you when you connect to them via SSH. As such, you cannot have multiple accounts with the same key, as GitHub won’t be able to tell then which of your accounts you want to use.</code></em><br>上面说的话很清楚，就是你不能有多个账号添加了同一个公钥，一旦那样github就不能区分到底是哪个用户在安全登陆网站，那安全登录就起不到任何效果了，因为你能登进去，我也能登进去，那服务器到底判断是谁登了呢！但是要注意一个账号可以拥有多个公钥，这个是可以允许的！比如，在A电脑和B电脑上的公钥都绑定了同个一个账户Tom，那么两台电脑在终端上输入<code>ssh -T git@github.com</code>最后都会显示<br><code>Hi Tom! You&#39;ve successfully authenticated, but GitHub does not provide shell access.</code><br>服务器依然会知道这是Tom的第二台电脑在登陆，他是土豪，账号依然很安全！</p>
<p>##场景<br>下面再举个例子，Tom在公司有个公司账户publicAccount，然后回到家他也有自己创建私人的账号privateAccount，但是他只有一台电脑，意味着一般情况下，他要么用公司账户绑定电脑公钥，要么用家里私人账号绑定，但是不管哪一种绑定，最后都达不到这两个账号访问同一个远程仓库，那么协同开发也就成了泡沫！因为只有一台电脑，如果Tom试图访问没有绑定公钥的账户的时候，就会报错<code>ERROR: Permission to hbxn740150254/BestoneGitHub.git denied to Tom</code></p>
<p>##解决思路</p>
<ul>
<li>####买台新电脑，获得新公钥，这是最土豪也是最傻的方法</li>
<li><h4 id="利用自己唯一的电脑生成多公钥，公钥一多，不就可以想绑定多少个都行了吗，不怕你把它玩坏😂😂😂"><a href="#利用自己唯一的电脑生成多公钥，公钥一多，不就可以想绑定多少个都行了吗，不怕你把它玩坏😂😂😂" class="headerlink" title="利用自己唯一的电脑生成多公钥，公钥一多，不就可以想绑定多少个都行了吗，不怕你把它玩坏😂😂😂"></a>利用自己唯一的电脑生成多公钥，公钥一多，不就可以想绑定多少个都行了吗，不怕你把它玩坏😂😂😂</h4></li>
</ul>
<p>##解决方案</p>
<ul>
<li><h4 id="1、生成一个新的SSH-KEY"><a href="#1、生成一个新的SSH-KEY" class="headerlink" title="1、生成一个新的SSH KEY"></a>1、生成一个新的SSH KEY</h4></li>
</ul>
<p>AppledeiMac:~ Apple$ cd ~/.ssh<br>AppledeiMac:.ssh Apple$ ls<br>id_rsa        id_rsa.pub    known_hosts<br>AppledeiMac:.ssh Apple$ ssh-keygen -t rsa -C “iMac_personnal_publicKey”<br>Generating public/private rsa key pair.<br>Enter file in which to save the key (/Users/Apple/.ssh/id_rsa):<br>/Users/Apple/.ssh/id_rsa_personal<br>Enter passphrase (empty for no passphrase):<br>Enter same passphrase again:<br>Your identification has been saved in /Users/Apple/.ssh/id_rsa_personal.<br>Your public key has been saved in /Users/Apple/.ssh/id_rsa_personal.pub.<br>The key fingerprint is:<br>SHA256:1gepuxDHwJRnFbKvc0Zq/NGrFGE9kEXS06jxatPPrSQ iMac_personnal_publicKey<br>The key’s randomart image is:<br>+—[RSA 2048]—-+<br>|      ….=*oo   |<br>|     o. ooo=+ .  |<br>|      oo. =+o.   |<br>|       o =.o..   |<br>|      . S =o.    |<br>|       = =++.    |<br>|      . B.=.Eo.. |<br>|       o B . +o .|<br>|          . o.. .. |<br>+—-[SHA256]—–+<br>AppledeiMac:.ssh Apple$ ls<br>id_rsa            id_rsa_personal        known_hosts<br>id_rsa.pub        id_rsa_personal.pub`</p>
<ul>
<li><h4 id="2、打开新生成的-ssh-id-rsa2-pub文件，将里面的内容添加到GitHub后台。"><a href="#2、打开新生成的-ssh-id-rsa2-pub文件，将里面的内容添加到GitHub后台。" class="headerlink" title="2、打开新生成的~/.ssh/id_rsa2.pub文件，将里面的内容添加到GitHub后台。"></a>2、打开新生成的~/.ssh/id_rsa2.pub文件，将里面的内容添加到GitHub后台。</h4></li>
<li>####3、打开~/.ssh/config文件<br>没有config文件则创建，终端输入touch config  ，创建完以后用Vim打开或者是在Finder打开一样。<br>在不影响默认的github设置下我们重新添加一个Host：<br>建一个自己能辨识的github别名，我取的是github-personal，新建的帐号使用这个别名做克隆和更新</li>
</ul>
<p>Host github-personal<br>HostName github.com<br>User git<br>IdentityFile ~/.ssh/id_rsa_personal</p>
<p>编辑完毕之后按下ESC，:wq，:wq是保存并退出vim编辑器<br>具体在终端代码如下：<br>cat config  是把config文件里面的内容在终端输出<br>AppledeiMac:.ssh Apple$ vim config<br>AppledeiMac:.ssh Apple$ cat config</p>
<p>#Default GitHub<br>Host github.com<br>HostName github.com<br>User git<br>IdentityFile ~/.ssh/id_rsa</p>
<p>Host github-personal<br>HostName github.com<br>User git<br>IdentityFile ~/.ssh/id_rsa_personal</p>
<ul>
<li>####4、将GitHub SSH仓库地址中的git@github.com替换成新建的Host别名。<br>如原地址是 <code>git@github.com:hbxn740150254/BestoneGitHub.git</code> 替换后应该是：<code>github-personal:hbxn740150254/BestoneGitHub.git</code> 或者<code>git@github-personal:hbxn740150254/BestoneGitHub.git</code>亲测都是可以的，<br>如果是新建的仓库，直接使用替换后的URL克隆即可。如果已经使用原地址克隆过了，可以使用命令修改：</li>
</ul>
<p>AppledeiMac:.ssh Apple$ cd /Users/Apple/Desktop/BestoneDemo<br>//修改之前<br>Apple$ git remote -v<br>github    git@github.com:hbxn740150254/BestoneGitHub.git (fetch)<br>github    git@github.com:hbxn740150254/BestoneGitHub.git (push)<br>//修改 remote set-url<br>AppledeiMac:BestoneDemo Apple$ git remote set-url github  github- personal:hbxn740150254/BestoneGitHub.git<br>//验证是否修改成功<br>//使用修改后的github-personal SSH连接，连接成功用户是hbxn740150254，此时公钥是id_rsa_personal<br>AppledeiMac:BestoneDemo Apple$ ssh -T github-personal<br>Hi hbxn740150254! You’ve successfully authenticated, but GitHub does not provide shell access.<br>//使用默认的git@github.com SSH去连接,连接成功用户是FaxeXian，此时公钥是id_rsa<br>AppledeiMac:.ssh Apple$ ssh -T git@github.com<br>Hi FaxeXian! You’ve successfully authenticated, but GitHub does not provide shell access.<br>//修改之后<br>AppledeiMac:BestoneDemo Apple$ git remote -v<br>github    github-personal:hbxn740150254/BestoneGitHub.git (fetch)<br>github    github-personal:hbxn740150254/BestoneGitHub.git (push)</p>
<p>最后我们进行正常的push，fetch 操作，都可以</p>
<p>//更改后的github push成功！<br>AppledeiMac:BestoneDemo Apple$ git push github testMerge:master<br>Total 0 (delta 0), reused 0 (delta 0)<br>To github-personal:hbxn740150254/BestoneGitHub.git<br>cd773e9..f622210  testMerge -&gt; master</p>
<p>//github默认的节点origin我们也可以正常push操作<br>AppledeiMac:BestoneDemo Apple$ git push origin testMerge:testMerge<br>Counting objects: 460, done.<br>Delta compression using up to 4 threads.<br>Compressing objects: 100% (240/240), done.<br>Writing objects: 100% (460/460), 16.69 MiB | 442.00 KiB/s, done.<br>Total 460 (delta 211), reused 453 (delta 205)<br>To git@git.coding.net:hbxn740150254/Local-Git.git</p>
<ul>
<li>[new branch]      testMerge -&gt; testMerge</li>
</ul>
<p>##github账户如果还是显示之前id_rsa密钥账户的话请把你的密钥加入sshAgent代理中</p>
<ul>
<li><h4 id="添加你的ssh密钥到ssh-agent中"><a href="#添加你的ssh密钥到ssh-agent中" class="headerlink" title="添加你的ssh密钥到ssh-agent中"></a>添加你的ssh密钥到ssh-agent中</h4><h1 id="start-the-ssh-agent-in-the-background"><a href="#start-the-ssh-agent-in-the-background" class="headerlink" title="start the ssh-agent in the background"></a>start the ssh-agent in the background</h1>eval “$(ssh-agent -s)”<br>Agent pid 59566</li>
<li><h5 id="如果你的密钥不是系统默认的RSA文件名id-rsa，比如像我一样另外创了一对公钥-密钥id-rsa-personal，那么就把他们添加进去，注意：密钥文件是不带扩展名的，公钥扩展名是-pub，代表publicKey，"><a href="#如果你的密钥不是系统默认的RSA文件名id-rsa，比如像我一样另外创了一对公钥-密钥id-rsa-personal，那么就把他们添加进去，注意：密钥文件是不带扩展名的，公钥扩展名是-pub，代表publicKey，" class="headerlink" title="如果你的密钥不是系统默认的RSA文件名id_rsa，比如像我一样另外创了一对公钥/密钥id_rsa_personal，那么就把他们添加进去，注意：密钥文件是不带扩展名的，公钥扩展名是.pub，代表publicKey，"></a>如果你的密钥不是系统默认的RSA文件名id_rsa，比如像我一样另外创了一对公钥/密钥id_rsa_personal，那么就把他们添加进去，注意：密钥文件是不带扩展名的，公钥扩展名是.pub，代表publicKey，</h5>apple:.ssh apple$ eval “$(ssh-agent -s)”<br>Agent pid 19795<br>//添加密钥 id_rsa_personal<br>apple:.ssh apple$ ssh-add id_rsa_personal<br>Identity added: id_rsa_personal (github-personal)<br>//添加默认密钥 id_rsa<br>apple:.ssh apple$ ssh-add id_rsa<br>//密钥有密码的话就会要你提示输入 passphrase<br>Enter passphrase for id_rsa:<br>//测试用密钥isa是否连接成功github<br>apple:.ssh apple$ ssh -T git@github.com<br>Hi hbxn740150254! You ‘ve successfully authenticated, but GitHub does not provide shell access.<br>//测试密钥id_rsa_personal是否连接成功github<br>apple:.ssh apple$ ssh -T git@github-personal<br>Hi FaxeXian! You’ve successfully authenticated, but GitHub does not provide shell access.<br><strong>这样，一台电脑生成的两个公钥让两个用户成功连接，就可以访问别人的远程仓库，可以进行多人开发了！！</strong></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  

          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Michael的小屋" />
          <p class="site-author-name" itemprop="name">Michael的小屋</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Michael的小屋</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
